<!DOCTYPE html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta http-equiv=content-type content="text/html; charset=utf-8"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Firm Grip on Menus in Drupal &middot; MrMaksimize</title><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=/assets/stylesheets/style.min.192c83ce.css><link rel=stylesheet href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400"><script src=/assets/javascript/all.min.74be1697.js></script><link rel=apple-touch-icon-precomposed sizes=144x144 href=/assets/images/touch/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/assets/favicon.ico><link rel=alternate type=application/rss+xml title=RSS href=/atom.xml></head><body class=sidebar-overlay><input type=checkbox class=sidebar-checkbox id=sidebar-checkbox><div class=sidebar id=sidebar><div class=sidebar-item><img class=sidebar-image width=100% height=100% src="http://mrm-random.s3.amazonaws.com/dz/maksim.jpg"><p>Gov, Code, Thoughts. This is a place for me to speak freely and represent no one.</p></div><nav class=sidebar-nav><a class=sidebar-nav-item href="/">Home</a> <a class=sidebar-nav-item href=/about.html>About</a> <a class=sidebar-nav-item href=/guides/index.html>Guides</a> <a class=sidebar-nav-item href=/speaking.html>Speaking</a> <span class="sidebar-nav-item social-links"><a href=https://github.com/mrmaksimize target=_blank title=Github><i class="fa fa-2x fa-github"></i></a> <a href=https://twitter.com/mrmaksimize target=_blank title=Twitter><i class="fa fa-2x fa-twitter"></i></a> <a href=https://linkedin.com/in/maxpecherskiy target=_blank title=LinkedIN><i class="fa fa-2x fa-linkedin"></i></a> <a href=mailto:max@maksimize.com><i class="fa fa-2x fa-envelope-o" title=E-Mail></i></a> <a href=/atom.xml title=RSS target=_blank><i class="fa fa-2x fa-rss"></i></a></span></nav><div class=sidebar-item><p>&copy; 2016. All rights reserved.</p></div></div><div class=wrap><div class=masthead><div class=container><h3 class=masthead-title><a href="/" title=Home>MrMaksimize</a></h3></div></div><div class="container content"><div class=post><h1 class=post-title>Firm Grip on Menus in Drupal</h1><span class=post-date>05 Jun 2013</span><p>For many that have worked with Drupal in teams before, I&rsquo;m sure you have run into problems with managing menus. There are many ways to create a menu item in Drupal, one of them being from the menu editor, and others when creating content or views, or panels pages.</p><p>The menu items created when you&rsquo;re creating content, views or panels override any configurations you may have set in the menu editor, hence the source of the problem.</p><p>In addition, the way that menu items are stored in features, they get explicitly linked to node id. So if you have a page on dev that&rsquo;s node/5 and the same page that lives on staging that&rsquo;s at node/6 and prod is node/7, it&rsquo;s extremely different to move menu configurations across environments.</p><p>This was causing a ton of wasted time and even more frustration.</p><p>Anyway, long story short, I needed a way to manage the menus on the site with an extremely firm grip.</p><p>I found this great module called <a href=https://drupal.org/project/menu_import>Menu Import</a>; The original purpose was to be able to create IA on a drupal site by simply creating a JSON file and running a drush command. The module will create the needed pages for you and the menu structure.</p><p>Let&rsquo;s look at an example menu export file: (Grabbed it from the <a href=https://drupal.org/project/menu_import>module page</a>)</p><div class=highlight><pre><code class=language-text data-lang=text>Pages {&quot;url&quot;:&quot;pages/all&quot;}
- Site {&quot;url&quot;:&quot;http://external-site.com/&quot;,&quot;description&quot;:&quot;Visit our site.&quot;}
- Story {&quot;url&quot;:&quot;node/3&quot;,&quot;description&quot;:&quot;A very interesting story!&quot;}
- Story {&quot;url&quot;:&quot;content/about&quot;,&quot;description&quot;:&quot;About us&quot;}
-- Some node {&quot;url&quot;:&quot;node/4&quot;,&quot;lang&quot;:&quot;da&quot;,&quot;description&quot;:&quot;Links is in Danish language&quot;}
Archive
- Admin zone {&quot;url&quot;:&quot;admin/appearance&quot;,&quot;description&quot;:&quot;Internal link with description.&quot;}
A page {&quot;description&quot;:&quot;Description only, no link.&quot;,&quot;hidden&quot;:true,&quot;expanded&quot;:true}
</code></pre></div><p>As you can see - you can definitely use router paths like <code>node/3</code> but you can also use alias paths for nodes as well like &lsquo;content/about&rsquo;. This means now we donâ€™t have to worry about the node id, only the path.</p><p>Menu Import also has a nice little piece of functionality where you can export your current menu structure to a json file. So that&rsquo;s what I did -</p><div class=highlight><pre><code class=language-text data-lang=text>drush menu-export main-menu-export.txt main-menu
</code></pre></div><p>I then saved the file inside of the feature where I wanted my menu structure to be.</p><p>And subsequently, I added the following to the feature&rsquo;s .module file:</p><div class=highlight><pre><code class=language-php data-lang=php>&lt;?php
function my_menu_feature_pre_features_revert($component) {
  // I actually had two menus, that&#39;s why the foreach loop.
  $menu_export_files = array(
    &#39;main-menu&#39; =&gt; &#39;main-menu-export.txt&#39;,
  );
  $results = array();
  if ($component == &#39;menu_custom&#39;) {
    if (!function_exists(&#39;menu_import_file&#39;)) {
      module_enable(array(&#39;menu_import&#39;));
    }
    $path = drupal_get_path(&#39;module&#39;, &#39;my_menu_feature&#39;);
    foreach ($menu_export_files as $menu_name =&gt; $menu_export_file) {
      $result = menu_import_file($path . &#39;/&#39; . $menu_export_file, $menu_name, array(
        &#39;link_to_content&#39; =&gt; TRUE,
        &#39;create_content&#39; =&gt; FALSE,
        &#39;remove_menu_items&#39; =&gt; TRUE,
      ));
      $results[$menu_name] = $result;
    }
    drush_print_r($results);
  }
}</code></pre></div><p>And the following to the .info file:</p><div class=highlight><pre><code class=language-php data-lang=php>features[menu_custom][] = main-menu</code></pre></div><p>That&rsquo;s it! Now, when I run <code>drush fr -y --force commons_main_menu</code>, it will force revert the feature and run the menu-import to update my menu items, deleting any previous problems before doing so.</p><p>The reason I need to do a <code>--force</code> is because features may not detect any menu change configurations, so I&rsquo;m forcing it to revert.</p><p>That is all friends. Enjoy your menu stability!</p></div><div class=related><h2>Related Posts</h2><ul class=related-posts><li><h3><a href="/what-i-learned-one-year-cdo/">What I Learned In One Year as CDO of San Diego <small>11 Jan 2016</small></a></h3></li><li><h3><a href="/ghost_continous_deployment/">Continuous Deployment of Ghost from Github <small>08 Feb 2014</small></a></h3></li><li><h3><a href="/webhooks/">Webhooks: A Different Pattern <small>03 Sep 2014</small></a></h3></li></ul></div><div id=disqus_thread></div><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'mrmaksimize'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><label for=sidebar-checkbox class=sidebar-toggle></label></body></html>